<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>阿里百秀-发现生活，发现美!</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.css">
</head>
<body>
  <div class="wrapper">
    <div class="topnav">
      <ul id="topBox">
       
      </ul>
    </div>
    <div class="header">
      <h1 class="logo"><a href="index.html"><img src="assets/img/logo.png" alt=""></a></h1>
      <ul class="nav" id="categoryBox">
      
      </ul>
      <div class="search">
        <form>
          <input type="text" class="keys" placeholder="输入关键字">
          <input type="submit" class="btn" value="搜索">
        </form>
      </div>
    </div>
    <div class="aside">
      <div class="widgets">
        <h4>搜索</h4>
        <div class="body search">
          <form>
            <input type="text" class="keys" placeholder="输入关键字">
            <input type="submit" class="btn" value="搜索">
          </form>
        </div>
      </div>
      <div class="widgets">
        <h4>随机推荐</h4>
        <ul class="body random">
          <li>
            <a href="javascript:;">
              <p class="title">废灯泡的14种玩法 妹子见了都会心动</p>
              <p class="reading">阅读(819)</p>
              <div class="pic">
                <img src="uploads/widget_1.jpg" alt="">
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <p class="title">可爱卡通造型 iPhone 6防水手机套</p>
              <p class="reading">阅读(819)</p>
              <div class="pic">
                <img src="uploads/widget_2.jpg" alt="">
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <p class="title">变废为宝！将手机旧电池变为充电宝的Better</p>
              <p class="reading">阅读(819)</p>
              <div class="pic">
                <img src="uploads/widget_3.jpg" alt="">
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <p class="title">老外偷拍桂林芦笛岩洞 美如“地下彩虹”</p>
              <p class="reading">阅读(819)</p>
              <div class="pic">
                <img src="uploads/widget_4.jpg" alt="">
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <p class="title">doge神烦狗打底南瓜裤 就是如此魔性</p>
              <p class="reading">阅读(819)</p>
              <div class="pic">
                <img src="uploads/widget_5.jpg" alt="">
              </div>
            </a>
          </li>
        </ul>
      </div>
      <div class="widgets">
        <h4>最新评论</h4>
        <ul class="body discuz">
          <li>
            <a href="javascript:;">
              <div class="avatar">
                <img src="uploads/avatar_1.jpg" alt="">
              </div>
              <div class="txt">
                <p>
                  <span>鲜活</span>2020-02-01说:
                </p>
                <p>挺会玩的</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <div class="avatar">
                <img src="uploads/avatar_1.jpg" alt="">
              </div>
              <div class="txt">
                <p>
                  <span>鲜活</span>2020-02-01说:
                </p>
                <p>挺会玩的</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <div class="avatar">
                <img src="uploads/avatar_2.jpg" alt="">
              </div>
              <div class="txt">
                <p>
                  <span>鲜活</span>2020-02-01说:
                </p>
                <p>挺会玩的</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <div class="avatar">
                <img src="uploads/avatar_1.jpg" alt="">
              </div>
              <div class="txt">
                <p>
                  <span>鲜活</span>2020-02-01说:
                </p>
                <p>挺会玩的</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <div class="avatar">
                <img src="uploads/avatar_2.jpg" alt="">
              </div>
              <div class="txt">
                <p>
                  <span>鲜活</span>2020-02-01说:
                </p>
                <p>挺会玩的</p>
              </div>
            </a>
          </li>
          <li>
            <a href="javascript:;">
              <div class="avatar">
                <img src="uploads/avatar_1.jpg" alt="">
              </div>
              <div class="txt">
                <p>
                  <span>鲜活</span>2020-02-01说:
                </p>
                <p>挺会玩的</p>
              </div>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="content">
      <div class="article" id="articleBox">
        
      </div>
      <div id="commentBox">

      </div>
      <div class="panel hots">
        <h3>热门推荐</h3>
        <ul id="hotRecommand">
        </ul>
      </div>
    </div>
    <div class="footer">
      <p>© 2016 XIU主题演示 本站主题由 themebetter 提供</p>
    </div>
  </div>
  <script src="assets/vendors/jquery/jquery.js"></script>
  <script src="assets/vendors/nprogress/nprogress.js"></script>
  <script src="assets/vendors/art-template/template-web.js"></script>
  <script src="assets/js/recommond.js"></script>
  <!-- 文章详情模板 -->
  <script type="text/html" id="articleTpl" >
    <div class="breadcrumb" >
      <dl>
        <dt>当前位置：</dt>
        <dd><a href="javascript:;">{{category.title}}</a></dd>
        <dd>{{title}}</dd>
      </dl>
    </div>
    <h2 class="title">
      <a href="javascript:;">{{title}}</a>
    </h2>
    <div class="meta">
      <span>{{author.nickName}} 发布于 {{createAt.split('T')[0]}}</span>
      <span>分类: <a href="javascript:;">{{category.title}}</a></span>
      <span>阅读: ({{meta.views}})</span>
      <span>评论: ({{meta.comments}})</span>
      <a href="javascript:;" id="like" data-id='{{_id}}'>赞</a>
    </div>
    {{content}}
  </script>
  <script type="text/html" id="commentTpl">
    <style type="text/css">
      .comment {
        margin-bottom: 20px;
      }
      .comment textarea{
        box-sizing: border-box;
        padding: 10px;
        width: 100%;
        height: 80px;
        display: block;
      }
      .comment input {
        width: 100px;
        height: 30px;
        margin-top: 10px;
      }
    </style>
    <div class="comment">
      <form id="commentForm">
        <textarea></textarea>
        <input type="submit" value="提交评论">
      </form>
    </div>
  </script>
  <script type="text/html" id="categoryTpl">
    {{each data}}
    <li><a href="list.html?categoryId={{$value._id}}"><i class="fa {{$value.className}}"></i>{{$value.title}}</a></li>
    {{/each}}
  </script>



<!-- 实现功能的js -->
  <script> 
  function getparams(name) {
    var paramAry = location.search.substr(1).split('&');
    for(var i=0;i<paramAry.length;i++) {
     var tmp = paramAry[i].split('=');
      if(tmp[0]==name) {
        return tmp[1]
      }
    }
  }
  // console.log(getparams('age'));
  var postId = getparams('id');
  $.ajax({
    type:'get',
    url: '/posts/' + postId,
    success:function(response) {
      console.log(response);
      var html = template('articleTpl',response);
      $('#articleBox').html(html)
  }
});
// 点赞功能
$('#articleBox').on('click','#like',function(){
  var id = $(this).attr('data-id');
  // console.log(id);
  $.ajax({
    type:'post',
    url:'/posts/fabulous/'+id,
    success:function(response){
      // console.log(response);
      location.reload();
    }
  })
});
//获取网站的配置信息,如果禁用了评论，那么用户也不能进行评论
var review ;
$.ajax({
    type:'get',
    url:'/settings',
    success:function(response) {
      review = response.review;
      console.log(response);
    // 判断管理员是否开启了评论功能，如果开启评论功能，渲染评论模板
    if(response.comment) {
      var html = template('commentTpl');
      $('#commentBox').html(html)
    }
    }
});
//提交评论表单

$('#commentBox').on('submit','#commentForm',function(){
  // alert(1)
  //获取评论区域的信息
  var content = $(this).find('textarea').val();
  if(content.trim().length==0) {
    alert('请输入内容');
    return false;
  }
  // alert(content)
  //判断评论的状态
  var state;
  if(review) {
    //要经过人工审核
    state=0;
  } else {
    state =1;
  }
  
  $.ajax({
  type:'get',
  url:'/comments',
  data: {
    content:content,
    post: postId,
    state:state,
  },
  success:function(response) {
    console.log(response);
    
    alert('评论成功')
    location.reload()
  }
})
  return false;
})

  //索要文章分类列表
  $.ajax({
    url:'/categories',
    type:'get',
    success:function(response){
      console.log(response);
      var html = template('categoryTpl',{data:response});
      console.log(html);
      $('#categoryBox').html(html);
      $('#topBox').html(html)
    }
  });
  </script>
</body>
</html>
